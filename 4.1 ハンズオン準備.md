- 流れ
  - Github ダウンロード
  - スキーマ＆データセットアップ
    - Blob：Portalからデータファイル(ディレクトリ構造済み)をアップロード
    - SQLDB：INSERT or ARM deployの中でbacpacインポート（bacpac置き場のBlobが必要）
		
- 5章、6章
  - サービス
    - Synapse
    - SQLDB
    - Blob
  - スキーマ
    - Blob生データディレクトリ　ADPE2E/source/nyctaxidata
    - ADLS生データディレクトリ　ADPE2E/raw/nyctaxidata-raw
    - SQLDB参照データ　TaxiLocationLookup
    - Dedicated参照テーブル　TaxiLocationLookup
    - Dedicated結果テーブル　TaxiDataSummary
  -  生データ
     -  Blob 生データ
     -  SQLDB参照データ


---
## **事前準備**

1. リソース一式をダウンロード   

   1. [Github](https://github.com/gho9o9/SynapseHandsOn)  

      ![](images/SynapseTechBook_2022-01-24-23-03-12.png)

   2. [Sample Data](https://o9o9storageshare.blob.core.windows.net/share/synapse_hands_on/nyctaxidata.zip)  
      
      ![](images/SynapseTechBook_2022-01-24-23-18-16.png)

2. Azure リソースのデプロイ

   1. Synapse のデプロイ

      1. 検索  
         ![](images/SynapseTechBook_2022-01-24-21-53-26.png)

      2. 作成  
         ![](images/SynapseTechBook_2022-01-24-21-54-34.png)

      3. 基本  
         ![](images/SynapseTechBook_2022-01-24-22-04-17.png)

      4. セキュリティ  
         ![](images/SynapseTechBook_2022-01-24-22-06-05.png)

      5. ネットワーク  
         ![](images/SynapseTechBook_2022-01-24-22-06-42.png)

      6. タグ  
         ![](images/SynapseTechBook_2022-01-24-22-07-13.png)

      7. レビュー＋作成  
         ![](images/SynapseTechBook_2022-01-24-22-08-02.png)
   
   2. Synapse Dedicated SQL Pool の作成
   
      1. 作成  

        ![](images/SynapseTechBook_2022-01-25-09-32-58.png)

      2. 基本  
        
        ***TODO：後続のPower BIレポートはDB名を即値dedicatedsqlが前提（pbitのパラメータにできる？）***

        | 項目 | 値 |
        | :---- | :---- |
        | 専用 SQL プール名 | 例：dedicatedsql |
        | パフォーマンスレベル | 例：DW100c |

        ![](images/SynapseTechBook_2022-01-25-09-39-42.png)

      3. 追加設定
        
        | 項目 | 値 |
        | :---- | :---- |
        | 照合順序 | 例：Japanese_XJIS_100_CS_AS_KS_WS |      

      4. タグ

        ![](images/SynapseTechBook_2022-01-25-10-04-38.png)

      5. 確認および作成

        ![](images/SynapseTechBook_2022-01-25-10-05-06.png)


   3. その他のAzureリソースのデプロイ  
      
      1. Deploy to Azure ボタンをクリック  

         [![Deploy to Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fgho9o9%2Fshare%2Fmain%2Ftest%2FazureDeploy.json)

      2. Azure ログイン  

         ![](images/SynapseTechBook_2022-01-24-22-12-41.png)

      3. パラメータ指定  

         ![](images/SynapseTechBook_2022-01-24-23-23-04.png)

      4. 作成  
      
         ![](images/SynapseTechBook_2022-01-24-23-23-32.png)   
      
3. Azure リソースの Set Up  

   1. Blob へのデータファイルのアップロード  

      1. Portalのデータエクスプローラーからディレクトリ *source/nyctaxidata* を作成

         ![](images/SynapseTechBook_2022-01-25-00-09-42.png)

      2. Sample Data 一式をアップロード

         ![](images/SynapseTechBook_2022-01-25-00-30-28.png)

   2. SQLDB のスキーマ定義とデータ投入  

      1. Portal のクエリエディタから SQLDB にログイン  

         ![](images/SynapseTechBook_2022-01-25-00-15-09.png)

      2. 「クエリを開く」から *resource/script/sqldb.sql* を開き「実行」  

         ![](images/SynapseTechBook_2022-01-25-00-18-49.png)

   3. Synapse と Purview のリンク  

      1. Synapse Studio 起動  
         
          ![](images/SynapseTechBook_2022-01-25-00-32-59.png)

      2.  Purview カウントに接続  

          ![](images/SynapseTechBook_2022-01-25-00-34-06.png)

          ![](images/SynapseTechBook_2022-01-25-00-34-43.png)

          ![](images/SynapseTechBook_2022-01-25-00-36-50.png)

3. Power BI Desktop のインストール  
   
   ***TODO：ダウンロード版とMicrosoft Store版がある（とりあえず 自動アップデートされるMS Store版で解説👇）***  
   ***TODO: 参考：https://bi-seminar.jp/2018/03/07/power-bi-desktop-2way-install/***

   https://powerbi.microsoft.com/ja-jp/downloads/

   ![](images/SynapseTechBook_2022-01-30-19-45-21.png)

   ![](images/SynapseTechBook_2022-01-30-19-51-03.png)

